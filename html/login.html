<!DOCTYPE html>
<html lang="en" data-theme="emerald">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Highland Fresh</title>
    
    <!-- Tailwind CSS + DaisyUI CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
    
    <!-- Custom config for Tailwind CDN -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Minimal custom styles -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-mesh {
            background: 
                radial-gradient(at 40% 20%, rgba(16, 185, 129, 0.15) 0px, transparent 50%),
                radial-gradient(at 80% 0%, rgba(5, 150, 105, 0.1) 0px, transparent 50%),
                radial-gradient(at 0% 50%, rgba(16, 185, 129, 0.1) 0px, transparent 50%),
                radial-gradient(at 80% 50%, rgba(5, 150, 105, 0.08) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(16, 185, 129, 0.12) 0px, transparent 50%);
        }
    </style>
</head>
<body class="min-h-screen bg-base-200 gradient-mesh">
    
    <div class="min-h-screen flex">
        <!-- Left Side - Branding (hidden on mobile) -->
        <div class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-emerald-600 to-emerald-800 p-12 flex-col justify-between relative overflow-hidden">
            <!-- Decorative elements -->
            <div class="absolute inset-0 opacity-10">
                <div class="absolute top-20 left-20 w-72 h-72 bg-white rounded-full blur-3xl"></div>
                <div class="absolute bottom-20 right-20 w-96 h-96 bg-emerald-300 rounded-full blur-3xl"></div>
            </div>
            
            <div class="relative z-10">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center">
                        <i class="fas fa-cow text-2xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Highland Fresh</h1>
                        <p class="text-emerald-200 text-sm">Dairy Production System</p>
                    </div>
                </div>
            </div>
            
            <div class="relative z-10 space-y-8">
                <!-- Feature highlights -->
                <div class="space-y-6">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-flask text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-white font-semibold">Quality Control</h3>
                            <p class="text-emerald-200 text-sm">Track milk grades, batches & lab results</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-industry text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-white font-semibold">Production Management</h3>
                            <p class="text-emerald-200 text-sm">Recipes, batches & CCP monitoring</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-warehouse text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-white font-semibold">Inventory Control</h3>
                            <p class="text-emerald-200 text-sm">FIFO tracking & stock management</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="relative z-10">
                <p class="text-emerald-200 text-sm">&copy; 2026 Highland Fresh Dairy. All rights reserved.</p>
            </div>
        </div>
        
        <!-- Right Side - Login Form -->
        <div class="w-full lg:w-1/2 flex items-center justify-center p-6 sm:p-12">
            <div class="w-full max-w-md">
                <!-- Mobile Logo -->
                <div class="lg:hidden text-center mb-8">
                    <div class="w-16 h-16 bg-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-cow text-3xl text-white"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-base-content">Highland Fresh</h1>
                    <p class="text-base-content/60 text-sm">Dairy Production System</p>
                </div>
                
                <!-- Login Card -->
                <div class="card bg-base-100 shadow-xl border border-base-300/50">
                    <div class="card-body p-8">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-bold text-base-content">Welcome back</h2>
                            <p class="text-base-content/60 mt-1">Sign in to your account</p>
                        </div>
                        
                        <!-- Error Alert -->
                        <div id="loginError" class="alert alert-error mb-4 hidden">
                            <i class="fas fa-exclamation-circle"></i>
                            <span id="errorMessage">Invalid username or password</span>
                        </div>
                        
                        <!-- Login Form -->
                        <form id="loginForm" class="space-y-5">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-medium">Username</span>
                                </label>
                                <label class="input input-bordered flex items-center gap-3 focus-within:input-primary">
                                    <i class="fas fa-user text-base-content/40"></i>
                                    <input type="text" id="username" class="grow" placeholder="Enter your username" required autofocus />
                                </label>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text font-medium">Password</span>
                                </label>
                                <label class="input input-bordered flex items-center gap-3 focus-within:input-primary">
                                    <i class="fas fa-lock text-base-content/40"></i>
                                    <input type="password" id="password" class="grow" placeholder="Enter your password" required />
                                    <button type="button" class="btn btn-ghost btn-xs btn-circle" onclick="togglePassword()">
                                        <i class="fas fa-eye text-base-content/40" id="toggleIcon"></i>
                                    </button>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="label cursor-pointer gap-2">
                                    <input type="checkbox" class="checkbox checkbox-primary checkbox-sm" id="rememberMe" />
                                    <span class="label-text">Remember me</span>
                                </label>
                                <a href="#" class="link link-primary text-sm">Forgot password?</a>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full" id="loginBtn">
                                <span id="btnText">Sign In</span>
                                <span id="btnLoading" class="hidden">
                                    <span class="loading loading-spinner loading-sm"></span>
                                    Signing in...
                                </span>
                            </button>
                        </form>
                        
                        <!-- Demo Credentials -->
                        <div class="divider text-xs text-base-content/40">Demo Accounts</div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button type="button" class="btn btn-ghost btn-sm text-xs" onclick="fillDemo('qc_officer', 'password')">
                                <i class="fas fa-flask"></i> QC Officer
                            </button>
                            <button type="button" class="btn btn-ghost btn-sm text-xs" onclick="fillDemo('production_staff', 'password')">
                                <i class="fas fa-industry"></i> Production
                            </button>
                            <button type="button" class="btn btn-ghost btn-sm text-xs" onclick="fillDemo('warehouse_raw', 'password')">
                                <i class="fas fa-warehouse"></i> Warehouse
                            </button>
                            <button type="button" class="btn btn-ghost btn-sm text-xs" onclick="fillDemo('general_manager', 'password')">
                                <i class="fas fa-user-tie"></i> Manager
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Footer for mobile -->
                <p class="lg:hidden text-center text-base-content/40 text-sm mt-6">
                    &copy; 2026 Highland Fresh Dairy
                </p>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../js/config/api.js"></script>
    <script src="../js/config/auth.js"></script>
    <script>
        // Redirect if already logged in
        if (AuthService.isAuthenticated()) {
            const user = AuthService.getCurrentUser();
            redirectToRoleDashboard(user.role);
        }
        
        // Toggle password visibility
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('toggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
        
        // Fill demo credentials
        function fillDemo(username, password) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
        }
        
        // Handle form submission
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const btnText = document.getElementById('btnText');
            const btnLoading = document.getElementById('btnLoading');
            const errorDiv = document.getElementById('loginError');
            
            // Reset error
            errorDiv.classList.add('hidden');
            
            // Show loading state
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');
            loginBtn.disabled = true;
            
            try {
                const response = await AuthService.login(username, password);
                
                if (response.success) {
                    redirectToRoleDashboard(response.data.user.role);
                }
            } catch (error) {
                document.getElementById('errorMessage').textContent = error.message || 'Invalid username or password';
                errorDiv.classList.remove('hidden');
            } finally {
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
                loginBtn.disabled = false;
            }
        });
        
        function redirectToRoleDashboard(role) {
            const roleDashboards = {
                'general_manager': 'dashboard.html',
                'qc_officer': 'qc/dashboard.html',
                'production_staff': 'production/dashboard.html',
                'warehouse_raw': 'warehouse/raw/dashboard.html',
                'warehouse_fg': 'warehouse/fg/dashboard.html',
                'sales_custodian': 'sales/dashboard.html',
                'cashier': 'pos/dashboard.html',
                'purchaser': 'purchasing/dashboard.html',
                'finance_officer': 'finance/dashboard.html',
                'bookkeeper': 'accounting/dashboard.html',
                'maintenance_head': 'maintenance/dashboard.html'
            };
            
            const dashboard = roleDashboards[role] || 'dashboard.html';
            window.location.href = dashboard;
        }
    </script>
</body>
</html>
